listen:
- 127.0.0.1:8080

debug-routing: true

routing:
  localhost/empty.gif: empty-gif
  localhost/sources: src
  localhost/websocket.html: websocket-echo-static
  localhost/websocket-echo: websocket-echo
  chat.example.com/: example-chat
  chat.example.com/css: example-chat-static
  chat.example.com/js: example-chat-static
  chat.example.com/index.html: example-chat-static

handlers:

  example-chat: !SwindonChat

    listen: 127.0.0.1:2007
    http-route: example-chat-http

    message-handlers:
      "*": superman/chat
      sub.chat.*: superman/sub_chat

  example-chat-http: !Proxy
    mode: forward
    ip-header: X-Remote-Ip
    destination: superman/

  empty-gif: !EmptyGif
  websocket-echo-static: !Static
    mode: relative_to_domain_root
    path: /work/public
    text-charset: utf-8
  websocket-echo: !WebsocketEcho

  src: !Static
    mode: relative_to_route
    path: /work/src
    text-charset: utf-8

http-destinations:
  superman:

    load-balancing: queue
    queue-size-for-503: 100k
    backend-connections-per-ip-port: 1
    in-flight-requests-per-backend-connection: 1

    addresses:
    - example.com:5000
